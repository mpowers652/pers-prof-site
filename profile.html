<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Matt Powers</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="header-root"></div>
    
    <main style="max-width: 800px; margin: 2rem auto; padding: 2rem;">
        <h2>User Profile</h2>
        
        <div id="profile-content">
            <div class="loading">Loading profile...</div>
        </div>
    </main>

    <script>
        async function loadProfile() {
            try {
                const response = await fetch('/auth/verify', { credentials: 'include' });
                if (!response.ok) {
                    window.location.href = '/login';
                    return;
                }
                
                const data = await response.json();
                const user = data.user || data;
                
                document.getElementById('profile-content').innerHTML = `
                    <div class="profile-card" style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 2rem; margin-bottom: 2rem;">
                            <div class="profile-pic" style="width: 100px; height: 100px; border-radius: 50%; background: rgba(102,102,102,0.5); display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; overflow: hidden;">
                                ${user.googlePhoto || user.facebookPhoto ? 
                                    `<img src="${user.googlePhoto || user.facebookPhoto}" style="width: 100%; height: 100%; object-fit: cover;" alt="Profile">` :
                                    user.username?.charAt(0) || 'U'
                                }
                            </div>
                            <div>
                                <h3>${user.username || 'User'}</h3>
                                <p>Email: ${user.email || 'Not provided'}</p>
                                <p>Role: <span style="background: ${user.role === 'admin' ? '#4CAF50' : '#2196F3'}; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">${user.role?.toUpperCase() || 'USER'}</span></p>
                                <p>Subscription: <span style="background: ${user.subscription === 'full' ? '#4CAF50' : user.subscription === 'premium' ? '#FF9800' : '#757575'}; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">${user.subscription?.toUpperCase() || 'BASIC'}</span></p>
                                <p>Date Created: ${user.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'Unknown'}</p>
                            </div>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.2); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                            <h4 style="margin-top: 0; color: #2196F3;">AI Credits</h4>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="flex: 1; background: rgba(255,255,255,0.1); border-radius: 8px; padding: 1rem;">
                                    <div style="font-size: 2rem; font-weight: bold; color: #4CAF50;">${user.aiCredits || 0}</div>
                                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">Available Credits</div>
                                </div>
                                ${!user.openaiKey ? '<div style="flex: 1;"><a href="/request-api-key" class="btn" style="width: 100%; text-align: center;">Request AI Access</a></div>' : '<div style="flex: 1; color: #4CAF50; text-align: center;">âœ“ AI Access Enabled</div>'}
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            ${user.role !== 'admin' ? '<a href="/subscription" class="btn">Manage Subscription</a>' : ''}
                            <a href="/logout" class="btn" style="background: #f44336;">Log Out</a>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('profile-content').innerHTML = '<div class="error">Failed to load profile</div>';
            }
        }
        
        window.addEventListener('DOMContentLoaded', loadProfile);
    </script>
    
    <div id="footer-root"></div>
    <script src="header-init.js"></script>
    <script src="dist/header.bundle.js"></script>
    <script src="dist/footer.bundle.js"></script>
</body>
</html>